
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="State machine based actor simulation framework for cyber range testbeds." name="description"/>
<link href="https://ait-aecid.github.io/kyoushi-simulation/examples/decorated_traveler/" rel="canonical"/>
<link href="../../images/favicon.ico" rel="shortcut icon"/>
<meta content="mkdocs-1.2.2, mkdocs-material-6.2.8" name="generator"/>
<title>Decorated Traveler - Cyber Range Kyoushi Simulation</title>
<link href="../../assets/stylesheets/main.cb6bc1d0.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.39b8e14a.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
<link href="../../stylesheets/extra.css" rel="stylesheet"/>
<link href="../../stylesheets/jquery.fancybox.min.css" rel="stylesheet"/>
</head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="ait" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#traveler-example">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header-nav md-grid">
<a aria-label="Cyber Range Kyoushi Simulation" class="md-header-nav__button md-logo" href="https://ait-aecid.github.io/kyoushi-simulation/" title="Cyber Range Kyoushi Simulation">
<img alt="logo" src="../../images/cr_icon.svg"/>
</a>
<label class="md-header-nav__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header-nav__title" data-md-component="header-title">
<div class="md-header-nav__ellipsis">
<div class="md-header-nav__topic">
<span class="md-ellipsis">
            Cyber Range Kyoushi Simulation
          </span>
</div>
<div class="md-header-nav__topic">
<span class="md-ellipsis">
            
              Decorated Traveler
            
          </span>
</div>
</div>
</div>
<label class="md-header-nav__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" data-md-component="search-reset" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header-nav__source">
<a class="md-source" href="https://github.com/ait-aecid/kyoushi-simulation/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    kyoushi-simulation
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Cyber Range Kyoushi Simulation" class="md-nav__button md-logo" href="https://ait-aecid.github.io/kyoushi-simulation/" title="Cyber Range Kyoushi Simulation">
<img alt="logo" src="../../images/cr_icon.svg"/>
</a>
    Cyber Range Kyoushi Simulation
  </label>
<div class="md-nav__source">
<a class="md-source" href="https://github.com/ait-aecid/kyoushi-simulation/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    kyoushi-simulation
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Overview
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" id="nav-2" type="checkbox"/>
<label class="md-nav__link" for="nav-2">
        Usage
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Usage" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-2">
<span class="md-nav__icon md-icon"></span>
          Usage
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../usage/getting_started/">
        Getting Started
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../usage/configuration/">
        Configuration
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../usage/logging/">
        Logging
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../usage/cli/">
        CLI Reference
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="nav-3" id="nav-3" type="checkbox"/>
<label class="md-nav__link" for="nav-3">
        Examples
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Examples" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-3">
<span class="md-nav__icon md-icon"></span>
          Examples
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../traveler/">
        Traveler
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Decorated Traveler
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Decorated Traveler
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#context">
    Context
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#decorated-transition-functions">
    Decorated Transition Functions
  </a>
<nav aria-label="Decorated Transition Functions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#updated-transition-functions">
    Updated transition functions
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#statemachine-and-context-setup">
    Statemachine and Context Setup
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#transition-and-state-configuration">
    Transition and State Configuration
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#running-the-example">
    Running the Example
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" id="nav-4" type="checkbox"/>
<label class="md-nav__link" for="nav-4">
        Code Reference
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Code Reference" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-4">
<span class="md-nav__icon md-icon"></span>
          Code Reference
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/model/">
        Models
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/states/">
        States
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/transitions/">
        Transitions
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/sm/">
        State Machine
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/util/">
        Utility Functions
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/errors/">
        Exceptions
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/config/">
        Configuration
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/logging/">
        Logging
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../contributing/">
        Contributing
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../license/">
        License
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#context">
    Context
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#decorated-transition-functions">
    Decorated Transition Functions
  </a>
<nav aria-label="Decorated Transition Functions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#updated-transition-functions">
    Updated transition functions
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#statemachine-and-context-setup">
    Statemachine and Context Setup
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#transition-and-state-configuration">
    Transition and State Configuration
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#running-the-example">
    Running the Example
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/ait-aecid/kyoushi-simulation/edit/main/docs/examples/decorated_traveler.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1 id="traveler-example">Traveler Example<a class="headerlink" href="#traveler-example" title="Permanent link">¶</a></h1>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>See the <a href="https://github.com/ait-aecid/kyoushi-simulation/-/tree/master/examples/decorated_traveler">examples directory</a> for the full code example.</p>
</div>
<p>This example is an alternative implementation of the state machine shown in the <a href="../traveler/">traveler example</a>.
The implementation does not use stateful transitions and uses transition decorators as an alternative to creating transition instances in the factory build method.
Here we will only show case the implementation changes for the full example description please take a look at <a href="../traveler/">traveler example</a>.</p>
<figure>
<a data-fancybox="gallery" href="https://ait-aecid.github.io/kyoushi-simulation/images/traveler.svg">
<img alt="Traveler state machine" src="https://ait-aecid.github.io/kyoushi-simulation/images/traveler.svg">
<figcaption>Traveler state machine</figcaption>
</img></a>
</figure>
<h2 id="context">Context<a class="headerlink" href="#context" title="Permanent link">¶</a></h2>
<p>Since we do not use stateful transition functions in this version, we need to provide the configuration options to the
modified transition functions as part of the context. For our simple example it is enough to base our <code>TravelerContext</code> on
our <code>TravelerConfig</code> instead <code>BaseModel</code>. This way <code>TravelerContext</code> will inherit all attributes from <code>TravelerConfig</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TravelerContext</span><span class="p">(</span><span class="n">TravelerConfig</span><span class="p">):</span>
    <span class="n">current_location</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StrictStr</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"The current location of the traveler."</span>
    <span class="p">)</span>
    <span class="n">chosen_city</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StrictStr</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"The city the traveler as chosen as potential travel destination."</span>
    <span class="p">)</span>
    <span class="n">weather</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Weather</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"The weather in the chosen city according to the travelers research."</span>
    <span class="p">)</span>
</code></pre></div>
<p>For the traveler state machine we use the context to share the <strong>current location</strong>, <strong>city</strong> and
the <strong>weather</strong> in the city across multiple transitions.</p>
<h2 id="decorated-transition-functions">Decorated Transition Functions<a class="headerlink" href="#decorated-transition-functions" title="Permanent link">¶</a></h2>
<details class="hint"><summary>Reminder</summary><p>We have the following transitions:</p>
<ol>
<li><code>hello</code>: For this transition we will print the <strong>name</strong> of our traveler and what kind of <strong>weather</strong> they like.</li>
<li><code>select_city</code>: Here our traveler will randomly choose a potential travel destination from the list of cities.</li>
<li><code>check_weather</code>: After choosing a destination they will have to check the weather in the city.</li>
<li><code>going_to_city</code>: Should the weather be to our travelers liking they will tell us so and that they are going to the city.</li>
<li><code>not_going</code>: Should it not be to their liking then the traveler will inform us that they changed their mind.</li>
<li><code>arrive</code>: Once the traveler has arrived the city they again will inform us.</li>
<li><code>going_to_sleep</code>: Finally should the traveler have grown tiered of traveling for the day they will let us know and then go to sleep.</li>
</ol>
</details>
<p>Using transition decorators like <a href="../../reference/transitions/#cr_kyoushi.simulation.transitions.transition"><code>transitions.transition</code></a> we can directly turn
a transition function into a transition. This is helpful to keep our code short and concise as we will not have to manually create
a transition instance in our factories build method.</p>
<details class="note"><summary>Note</summary><p>Using a transition decorator on a transition function is equivalent to initializing a transition by passing
the transition function i.e.,</p>
<div class="highlight"><pre><span></span><code><span class="nd">@transitions</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">"some_state"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_something</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">current_state</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"something"</span><span class="p">)</span>
</code></pre></div>
<p>is equivalent to</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">do_something_function</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">current_state</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"something"</span><span class="p">)</span>

<span class="n">do_something</span> <span class="o">=</span> <span class="n">transitions</span><span class="o">.</span><span class="n">Transition</span><span class="p">(</span><span class="n">do_something_function</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"do_something"</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">"some_state"</span><span class="p">)</span>
</code></pre></div>
</details>
<h3 id="updated-transition-functions">Updated transition functions<a class="headerlink" href="#updated-transition-functions" title="Permanent link">¶</a></h3>
<ol>
<li>
<p>The hello transition now reads the traveler and and preferred weather from the config instead of having its own state.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@transitions</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">"selecting_city"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">current_state</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">TravelerContext</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="sd">"""Transition function for the initial hello world message"""</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">"Hi I am </span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">traveler</span><span class="si">}</span><span class="s2">. "</span>
        <span class="sa">f</span><span class="s2">"I like to travel to cities that have </span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">desired_weather</span><span class="si">}</span><span class="s2"> weather."</span>
    <span class="p">)</span>
</code></pre></div>
</li>
<li>
<p>To select a city we need to first inline convert the weather map to a list of cities.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@transitions</span><span class="o">.</span><span class="n">delayed_transition</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">"researching"</span><span class="p">,</span> <span class="n">delay_after</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">select_city</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">current_state</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">TravelerContext</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="n">cities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">cities</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">context</span><span class="o">.</span><span class="n">chosen_city</span> <span class="o">=</span> <span class="n">StrictStr</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">cities</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Maybe I will travel to somewhere in </span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">chosen_city</span><span class="si">}</span><span class="s2">."</span><span class="p">)</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For the sake of execution efficiency one could also define the context and function so that this conversion
is only executed on the first call and then persisted as part of the context.</p>
</div>
</li>
<li>
<p>For the weather check we now simply access the map through the context.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@transitions</span><span class="o">.</span><span class="n">delayed_transition</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">"deciding"</span><span class="p">,</span> <span class="n">delay_before</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">delay_after</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_weather</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">current_state</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">TravelerContext</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="sd">"""Transition function to check the weather in the chosen city"""</span>
    <span class="n">context</span><span class="o">.</span><span class="n">weather</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">cities</span><span class="p">[</span><span class="n">StrictStr</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">chosen_city</span><span class="p">)]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The weather is </span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">weather</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">chosen_city</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p>Other than the decorator and name this is unchanged.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@transitions</span><span class="o">.</span><span class="n">delayed_transition</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">"traveling"</span><span class="p">,</span> <span class="n">delay_after</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">going_to_city</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">current_state</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">TravelerContext</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The weather is ok so I am going to </span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">chosen_city</span><span class="si">}</span><span class="s2"> now ..."</span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p>Other than the decorator and name this is unchanged.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@transitions</span><span class="o">.</span><span class="n">delayed_transition</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">"selecting_city"</span><span class="p">,</span> <span class="n">delay_before</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">not_going</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">current_state</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">TravelerContext</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"I don't like the weather in </span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">chosen_city</span><span class="si">}</span><span class="s2"> so I am not going ..."</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">chosen_city</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">context</span><span class="o">.</span><span class="n">weather</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
</li>
<li>
<p>Other than the decorator and name this is unchanged.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@transitions</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">"in_city"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">arrive</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">current_state</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">TravelerContext</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">"I have arrived in </span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">chosen_city</span><span class="si">}</span><span class="s2"> the weather is </span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">weather</span><span class="si">}</span><span class="s2"> just how I like it."</span>
    <span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">current_location</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">chosen_city</span>
    <span class="n">context</span><span class="o">.</span><span class="n">chosen_city</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">context</span><span class="o">.</span><span class="n">weather</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
</li>
<li>
<p>Similarly to the updated hello transition we now access the traveler name through the context.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@transitions</span><span class="o">.</span><span class="n">delayed_transition</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">"sleeping"</span><span class="p">,</span> <span class="n">delay_before</span><span class="o">=</span><span class="mf">3.5</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">going_to_sleep</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">current_state</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">TravelerContext</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="sd">"""Transition function that prints the final message before the traveler goes to sleep"""</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"I </span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">traveler</span><span class="si">}</span><span class="s2"> have travelled enough for now."</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"I am going to sleep in </span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">current_location</span><span class="si">}</span><span class="s2"> ..."</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"... zzzZZZzz ..."</span><span class="p">)</span>
</code></pre></div>
</li>
</ol>
<h2 id="statemachine-and-context-setup">Statemachine and Context Setup<a class="headerlink" href="#statemachine-and-context-setup" title="Permanent link">¶</a></h2>
<p>Since our modified <code>TravelerContext</code> now also contains the configuration options we have to modify our state machine initialization
and <a href="../../reference/sm/#cr_kyoushi.simulation.sm.Statemachine.setup_context">context setup</a>. Previously we simply created a <code>TravelerContext</code> instance
with everything set to its default values. In this version we pass our <code>TravelerConfig</code> instance when constructing the context.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TravelerStatemachine</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">Statemachine</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">states</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">TravelerConfig</span><span class="p">,</span>
        <span class="n">max_errors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">initial_state</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">max_errors</span><span class="o">=</span><span class="n">max_errors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__config</span> <span class="o">=</span> <span class="n">config</span>

    <span class="k">def</span> <span class="nf">setup_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Initialize with config values and use defaults for the rest"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">TravelerContext</span><span class="o">.</span><span class="n">parse_obj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">)</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="highlight"><span class="n">TravelerContext</span><span class="o">.</span><span class="n">parse_obj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">)</span></code> is basically just a short hand provided by Pydantic for:</p>
<div class="highlight"><pre><span></span><code><span class="n">TravelerContext</span><span class="p">(</span>
    <span class="n">traveler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">traveler</span><span class="p">,</span>
    <span class="n">desired_weather</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">desired_weather</span>
<span class="p">)</span>
</code></pre></div>
</div>
<h2 id="transition-and-state-configuration">Transition and State Configuration<a class="headerlink" href="#transition-and-state-configuration" title="Permanent link">¶</a></h2>
<p>The updated build method shows the biggest advantage of using transition decorator.
Since all our transition functions are decorated they are all automatically converted to transitions.
This means that we do not have to manually instantiate transition objects, but instead can directly pass
the converted transition functions into our states. This approach can significantly simplify and short our build functions
and state machine definitions.</p>
<div class="highlight"><pre><span></span><code>    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">TravelerConfig</span><span class="p">):</span>

        <span class="c1"># States</span>
        <span class="c1"># ----------------------------------</span>
        <span class="n">initial</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">SequentialState</span><span class="p">(</span><span class="s2">"initial"</span><span class="p">,</span> <span class="n">hello</span><span class="p">)</span>
        <span class="n">selecting_city</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">SequentialState</span><span class="p">(</span><span class="s2">"selecting_city"</span><span class="p">,</span> <span class="n">select_city</span><span class="p">)</span>
        <span class="n">researching</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">SequentialState</span><span class="p">(</span><span class="s2">"researching"</span><span class="p">,</span> <span class="n">check_weather</span><span class="p">)</span>
        <span class="n">deciding</span> <span class="o">=</span> <span class="n">DecidingState</span><span class="p">(</span>
            <span class="s2">"deciding"</span><span class="p">,</span>
            <span class="n">going</span><span class="o">=</span><span class="n">going_to_city</span><span class="p">,</span>
            <span class="n">not_going</span><span class="o">=</span><span class="n">not_going</span><span class="p">,</span>
            <span class="n">desired_weather</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">desired_weather</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">traveling</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">SequentialState</span><span class="p">(</span><span class="s2">"traveling"</span><span class="p">,</span> <span class="n">arrive</span><span class="p">)</span>
        <span class="n">in_city</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">ProbabilisticState</span><span class="p">(</span>
            <span class="s2">"in_city"</span><span class="p">,</span> <span class="p">[</span><span class="n">going_to_sleep</span><span class="p">,</span> <span class="n">select_city</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">sleeping</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">FinalState</span><span class="p">(</span><span class="s2">"sleeping"</span><span class="p">)</span>

        <span class="c1"># Initialize the state machine</span>
        <span class="k">return</span> <span class="n">TravelerStatemachine</span><span class="p">(</span>
            <span class="s2">"initial"</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="n">initial</span><span class="p">,</span>
                <span class="n">selecting_city</span><span class="p">,</span>
                <span class="n">researching</span><span class="p">,</span>
                <span class="n">deciding</span><span class="p">,</span>
                <span class="n">traveling</span><span class="p">,</span>
                <span class="n">in_city</span><span class="p">,</span>
                <span class="n">sleeping</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can only use transition decorators on functions (i.e., stateless transition functions).
This is because stateful transition functions are classes that need to be instantiated before the can be
used as transition functions.</p>
</div>
<h2 id="running-the-example">Running the Example<a class="headerlink" href="#running-the-example" title="Permanent link">¶</a></h2>
<p>To run the example state machine you can simply use the Cyber Range Kyoushi CLI.</p>
<p><div class="highlight"><pre><span></span><code>$ <span class="nb">cd</span> examples/decorated_traveler
$ cr-kyoushi-sim -c config.yml run -f traveler.py
</code></pre></div>
<a data-fancybox="gallery" href="https://ait-aecid.github.io/kyoushi-simulation/images/traveler-demo.gif">
<img alt="Traveler State Machine Demo" src="https://ait-aecid.github.io/kyoushi-simulation/images/traveler-demo.gif">
</img></a></p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav aria-label="Footer" class="md-footer-nav__inner md-grid">
<a class="md-footer-nav__link md-footer-nav__link--prev" href="../traveler/" rel="prev">
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Previous
                </span>
                Traveler
              </div>
</div>
</a>
<a class="md-footer-nav__link md-footer-nav__link--next" href="../../reference/model/" rel="next">
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                Models
              </div>
</div>
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
</div>
</div>
</footer>
</div>
<script src="../../assets/javascripts/vendor.18f0862e.min.js"></script>
<script src="../../assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
<script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
<script src="../../js/jquery-3.5.1.min.js"></script>
<script src="../../js/jquery.fancybox.min.js"></script>
</body>
</html>